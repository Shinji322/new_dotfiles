#!/bin/bash 
# Dependencies: docker docker-compose

install() {
  sudo usermod -a -G docker "$USER"
  docker pull searxng/searxng
}

run() {
  docker run --rm -d -p ${PORT}:8080 \
    -v "${XDG_CONFIG_HOME:-$HOME/.config}/searxng:/etc/searxng" \
    -e "BASE_URL:http://localhost:$PORT" \
    -e "INSTANCE_NAME=SearXNG" \
    searxng/searxng || exit 1
}

main() {
  if [ -n "$(docker ps | grep 'searxng/searxng')" ]; then
    docker container restart "$(docker ps | grep 'searxng/searxng' | cut -d ' ' -f1)"
  else
    run || install
  fi
}


export PORT=8080
run
